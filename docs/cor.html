
<html><head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta content="text/javascript" http-equiv="content-script-type">
<title>dstats.cor</title>
<link rel="stylesheet" type="text/css" href="candydoc/style.css">
<!--[if lt IE 7]><link rel="stylesheet" type="text/css" href="candydoc/ie56hack.css"><![endif]-->
<script language="JavaScript" src="candydoc/util.js" type="text/javascript"></script>
<script language="JavaScript" src="candydoc/tree.js" type="text/javascript"></script>
<script language="JavaScript" src="candydoc/explorer.js" type="text/javascript"></script>
</head><body>
<div id="tabarea"></div><div id="explorerclient"></div>
<div id="content"><script>explorer.initialize("dstats.cor");</script>
	<table class="content">
		<tr><td id="docbody"><h1>dstats.cor</h1><!-- Generated by Ddoc from dstats\cor.d -->
Pearson, Spearman and Kendall correlations, covariance.
<br><br>
<b>Author:</b><br>
David Simcha<br><br>


<script>explorer.outline.incSymbolLevel();</script>
<dl>
<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">PearsonCor 
<span class="currsymbol">pearsonCor</span>
<script>explorer.outline.addDecl('pearsonCor');</script>

(T, U)(T <span class="funcparam">input1</span>, U <span class="funcparam">input2</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Convenience function for calculating Pearson correlation.
 When the term correlation is used unqualified, it is
 usually referring to this quantity.  This is a parametric correlation
 metric and should not be used with extremely ill-behaved data.
 This function works with any pair of input ranges.
<br><br>
<b>Note:</b><br>
The PearsonCor struct returned by this function is alias this'd to the
 correlation coefficient.  Therefore, the result from this function can
 be treated simply as a floating point number.

<br><br>
<b>References:</b><br>
Computing Higher-Order Moments Online.
<br><br>
<b>http:</b><br>
//people.xiph.org/~tterribe/notes/homs.html<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">struct 
<span class="currsymbol">PearsonCor</span>
<script>explorer.outline.addDecl('PearsonCor');</script>

;
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Allows computation of mean, stdev, variance, covariance, Pearson correlation online.
 Getters for stdev, var, cov, cor cost floating point division ops.  Getters
 for means cost a single branch to check for N == 0.  This struct uses O(1)
 space.
<br><br>

<span class="currsymbol">PearsonCor</span>
<script>explorer.outline.addDecl('PearsonCor');</script>

.cor is alias this'd, so if this struct is used as a float, it will
 be converted to a simple correlation coefficient automatically.

<br><br>
<font color=red>BUGS:</font><br>
Alias this disabled due to compiler bugs.

<br><br>
<b>References:</b><br>
Computing Higher-Order Moments Online.
<br><br>
<b>http:</b><br>
//people.xiph.org/~tterribe/notes/homs.html<br><br>


<script>explorer.outline.incSymbolLevel();</script>
<dl>
<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">nothrow @safe void 
<span class="currsymbol">put</span>
<script>explorer.outline.addDecl('put');</script>

(double <span class="funcparam">elem1</span>, double <span class="funcparam">elem2</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">nothrow @safe void 
<span class="currsymbol">put</span>
<script>explorer.outline.addDecl('put');</script>

(ref const typeof(this) <span class="funcparam">rhs</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Combine two PearsonCor's.<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const const pure nothrow @property @safe double 
<span class="currsymbol">var1</span>
<script>explorer.outline.addDecl('var1');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const const pure nothrow @property @safe double 
<span class="currsymbol">var2</span>
<script>explorer.outline.addDecl('var2');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const const pure nothrow @property @safe double 
<span class="currsymbol">stdev1</span>
<script>explorer.outline.addDecl('stdev1');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const const pure nothrow @property @safe double 
<span class="currsymbol">stdev2</span>
<script>explorer.outline.addDecl('stdev2');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const const pure nothrow @property @safe double 
<span class="currsymbol">cor</span>
<script>explorer.outline.addDecl('cor');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const const pure nothrow @property @safe double 
<span class="currsymbol">cov</span>
<script>explorer.outline.addDecl('cov');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const const pure nothrow @property @safe double 
<span class="currsymbol">mean1</span>
<script>explorer.outline.addDecl('mean1');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const const pure nothrow @property @safe double 
<span class="currsymbol">mean2</span>
<script>explorer.outline.addDecl('mean2');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">const const pure nothrow @property @safe double 
<span class="currsymbol">N</span>
<script>explorer.outline.addDecl('N');</script>

();
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>
</dl>
<script>explorer.outline.decSymbolLevel();</script>


</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">double 
<span class="currsymbol">covariance</span>
<script>explorer.outline.addDecl('covariance');</script>

(T, U)(T <span class="funcparam">input1</span>, U <span class="funcparam">input2</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd><br><br>
</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">double 
<span class="currsymbol">spearmanCor</span>
<script>explorer.outline.addDecl('spearmanCor');</script>

(R, S)(R <span class="funcparam">input1</span>, S <span class="funcparam">input2</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Spearman's rank correlation.  Non-parametric.  This is essentially the
 Pearson correlation of the ranks of the data, with ties dealt with by
 averaging.<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">double 
<span class="currsymbol">kendallCor</span>
<script>explorer.outline.addDecl('kendallCor');</script>

(T, U)(T <span class="funcparam">input1</span>, U <span class="funcparam">input2</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Kendall's Tau-b, O(N log N) version.  This is a non-parametric measure
of monotonic association and can be defined in terms of the
bubble sort distance, or the number of swaps that would be needed in a
bubble sort to sort input2 into the same order as input1.
<br><br>
Since a copy of the inputs is made anyhow because they need to be sorted,
this function can work with any input range.  However, the ranges must
have the same length.

<br><br>
<b>Note:</b><br>
As an optimization, when a range is a SortedRange with predicate "a &lt; b",
it is assumed already sorted and not sorted a second time by this function.
This is useful when applying this function multiple times with one of the
arguments the same every time:
<br><br>

<pre class="d_code"><font color=blue>auto</font> lhs = randArray!rNorm(1_000, 0, 1);
<font color=blue>auto</font> indices = <font color=blue>new</font> size_t[1_000];
makeIndex(lhs, indices);

<font color=blue>foreach</font>(i; 0..1_000) {
    <font color=blue>auto</font> rhs = randArray!rNorm(1_000, 0, 1);
    <font color=blue>auto</font> lhsSorted = assumeSorted(
        indexed(lhs, indices)
    );

    <font color=green>// Rearrange rhs according to the sorting permutation of lhs.
</font>    <font color=green>// kendallCor(lhsSorted, rhsRearranged) will be much faster than
</font>    <font color=green>// kendallCor(lhs, rhs).
</font>    <font color=blue>auto</font> rhsRearranged = indexed(rhs, indices);
    <font color=blue>assert</font>(<u>kendallCor</u>(lhsSorted, rhsRearranged) == <u>kendallCor</u>(lhs, rhs));
}
</pre>

<br><br>
<b>References:</b><br>
A Computer Method for Calculating Kendall's Tau with Ungrouped Data,
William R. Knight, Journal of the American Statistical Association, Vol.
61, No. 314, Part 1 (Jun., 1966), pp. 436-439
<br><br>

The Variance of Tau When Both Rankings Contain Ties.  M.G. Kendall.
Biometrika, Vol 34, No. 3/4 (Dec., 1947), pp. 297-298<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">double 
<span class="currsymbol">kendallCorDestructive</span>
<script>explorer.outline.addDecl('kendallCorDestructive');</script>

(R1, R2)(R1 <span class="funcparam">input1</span>, R2 <span class="funcparam">input2</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Kendall's Tau-b O(N log N), overwrites input arrays with undefined data but
uses only O(log N) stack space for sorting, not O(N) space to duplicate
input.  R1 and R2 must be either SortedRange structs with the default predicate
or arrays.<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">double 
<span class="currsymbol">partial</span>
<script>explorer.outline.addDecl('partial');</script>

(alias cor, T, U, V...)(T <span class="funcparam">vec1</span>, U <span class="funcparam">vec2</span>, V <span class="funcparam">conditionsIn</span>);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>Computes the 
<span class="currsymbol">partial</span>
<script>explorer.outline.addDecl('partial');</script>

 correlation between vec1, vec2 given
 conditions.  conditions can be either a tuple of ranges, a range of ranges,
 or (for a single condition) a single range.
<br><br>
cor is the correlation metric to use.  It can be either pearsonCor,
 spearmanCor, kendallCor, or any custom correlation metric you can come up
 with.

<br><br>
<b>Examples:</b><br>
<pre class="d_code"> <font color=blue>uint</font>[] stock1Price = [8, 6, 7, 5, 3, 0, 9];
 <font color=blue>uint</font>[] stock2Price = [3, 1, 4, 1, 5, 9, 2];
 <font color=blue>uint</font>[] economicHealth = [2, 7, 1, 8, 2, 8, 1];
 <font color=blue>uint</font>[] consumerFear = [1, 2, 3, 4, 5, 6, 7];

 <font color=green>// See whether the prices of stock 1 and stock 2 are correlated even
</font> <font color=green>// after adjusting for the overall condition of the economy and consumer
</font> <font color=green>// fear.
</font> <font color=blue>double</font> partialCor =
   <u>partial</u>!pearsonCor(stock1Price, stock2Price, economicHealth, consumerFear);
</pre>
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">SymmetricMatrix!(double) 
<span class="currsymbol">pearsonMatrix</span>
<script>explorer.outline.addDecl('pearsonMatrix');</script>

(RoR)(RoR <span class="funcparam">mat</span>, TaskPool <span class="funcparam">pool</span> = null);
<br>SymmetricMatrix!(double) 
<span class="currsymbol">spearmanMatrix</span>
<script>explorer.outline.addDecl('spearmanMatrix');</script>

(RoR)(RoR <span class="funcparam">mat</span>, TaskPool <span class="funcparam">pool</span> = null);
<br>SymmetricMatrix!(double) 
<span class="currsymbol">kendallMatrix</span>
<script>explorer.outline.addDecl('kendallMatrix');</script>

(RoR)(RoR <span class="funcparam">mat</span>, TaskPool <span class="funcparam">pool</span> = null);
<br>SymmetricMatrix!(double) 
<span class="currsymbol">covarianceMatrix</span>
<script>explorer.outline.addDecl('covarianceMatrix');</script>

(RoR)(RoR <span class="funcparam">mat</span>, TaskPool <span class="funcparam">pool</span> = null);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>These functions allow efficient calculation of the Pearson, Spearman and
Kendall correlation matrices and the covariance matrix respectively.  They
are optimized to avoid computing certain values multiple times when computing
correlations of one vector to several others.
<br><br>
<b>Note:</b><br>
These functions are only available when SciD is installed and
       dstats is compiled with version=scid.

<br><br>
<b>Paramters:</b><br>
mat = A range of ranges to be treated as a set of vectors.  This must be
      a finite range, and must be rectangular, i.e. all elements must be
      the same length.  For Pearson correlation and covariance, the ranges
      must also have elements implicitly convertible to double.
      SciD matrices can be treated as ranges of ranges and can be used with
      these functions.
<br><br>

taskPool = A std.parallelism.TaskPool used to parallelize the computation.
           This is useful for very large matrices.  If none is provided,
           the computation will not be parallelized.
<br><br>


<br><br>
<b>Examples:</b><br>
<pre class="d_code"><font color=blue>auto</font> input = [[8.0, 6, 7, 5],
              [3.0, 0, 9, 3],
              [1.0, 4, 1, 5]];
<font color=blue>auto</font> pearson = <u>pearsonMatrix</u>(input);
<font color=blue>assert</font>(approxEqual(pearson[0, 0], 1));
</pre>
<br><br>

</dd>

<script>explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">pearsonMatrix</span>
<script>explorer.outline.addDecl('pearsonMatrix');</script>

(RoR, Ret)(RoR <span class="funcparam">mat</span>, ref Ret <span class="funcparam">ans</span>, TaskPool <span class="funcparam">pool</span> = null);
<br>void 
<span class="currsymbol">spearmanMatrix</span>
<script>explorer.outline.addDecl('spearmanMatrix');</script>

(RoR, Ret)(RoR <span class="funcparam">mat</span>, ref Ret <span class="funcparam">ans</span>, TaskPool <span class="funcparam">pool</span> = null);
<br>void 
<span class="currsymbol">kendallMatrix</span>
<script>explorer.outline.addDecl('kendallMatrix');</script>

(RoR, Ret)(RoR <span class="funcparam">mat</span>, ref Ret <span class="funcparam">ans</span>, TaskPool <span class="funcparam">pool</span> = null);
<br>void 
<span class="currsymbol">covarianceMatrix</span>
<script>explorer.outline.addDecl('covarianceMatrix');</script>

(RoR, Ret)(RoR <span class="funcparam">mat</span>, ref Ret <span class="funcparam">ans</span>, TaskPool <span class="funcparam">pool</span> = null);
</span></dt>
<script>explorer.outline.writeEnabled = false;</script>


<dd>These overloads allow for correlation and covariance matrices to be computed
with the results being stored in a pre-allocated variable, ans.  ans must
be either a SciD matrix or a random-access range of ranges with assignable
elements of a floating point type.  It must have the same number of rows
as the number of vectors in mat and must have at least enough columns in
each row to support storing the lower triangle.  If ans is a full rectangular
matrix/range of ranges, only the lower triangle results will be stored.
<br><br>
<b>Examples:</b><br>
<pre class="d_code"><font color=blue>auto</font> pearsonRoR = [[0.0], [0.0, 0.0], [0.0, 0.0, 0.0]];
<u>pearsonMatrix</u>(input, pearsonRoR);
<font color=blue>assert</font>(approxEqual(pearsonRoR[1][1], 1));
</pre>
<br><br>

</dd>
</dl>
<script>explorer.outline.decSymbolLevel();</script>


</td></tr>
		<tr><td id="docfooter">
			Page was generated with
			<img src="candydoc/img/candydoc.gif" style="vertical-align:middle; position:relative; top:-1px">
			on Sun Nov  6 11:33:56 2011

		</td></tr>
	</table>
</div>
<script>
    explorer.packageExplorer.addModule("dstats.all");
	explorer.packageExplorer.addModule("dstats.alloc");
	explorer.packageExplorer.addModule("dstats.base");
	explorer.packageExplorer.addModule("dstats.cor");
	explorer.packageExplorer.addModule("dstats.distrib");
	explorer.packageExplorer.addModule("dstats.infotheory");
	explorer.packageExplorer.addModule("dstats.random");
	explorer.packageExplorer.addModule("dstats.pca");
	explorer.packageExplorer.addModule("dstats.kerneldensity");
	explorer.packageExplorer.addModule("dstats.regress");	
	explorer.packageExplorer.addModule("dstats.sort");
	explorer.packageExplorer.addModule("dstats.summary");
	explorer.packageExplorer.addModule("dstats.tests");
</script>
</body></html>


